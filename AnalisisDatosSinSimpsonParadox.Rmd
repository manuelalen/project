---
title: "P√≠ldoras de Estad√≠stica: Paradoja Simpson en el an√°lisis de datos"
author: "Manuel Al√©n"
date: '√öltima actualizaci√≥n: `r format(as.Date(Sys.Date()), "%d-%m-%Y")`'
description: "Curso b√°sico de introducci√≥n a R (desde cero). Curso elaborado por Javier √Ålvarez Li√©bana (dadosdelaplace)"
output: html_document
---
```{r echo = FALSE, include = FALSE, chunk-1}
library(ggplot2)
library(tidyverse)
library(skimr)
library(RMySQL)
library(plotly)
library(metafor)
library(dplyr)
library(DT)
```

```{r echo = FALSE}
library(knitr)
# Color text
colorize <- function(x, color) {
  
  if (knitr::is_latex_output()) {
    
    sprintf("\\textcolor{%s}{%s}", color, x)
    
  } else if (knitr::is_html_output()) {
    
    sprintf("<span style='color: %s;'>%s</span>", color, x)
    
  } else { x }
}
```

# üôà Contexto

Un domingo tranquilo por Twitter y me encontr√© con esta publicaci√≥n

```{r contexto, echo = FALSE, fig.align = 'center',  include = identical(knitr:::pandoc_to(), 'html'), out.width = '70%'}
knitr::include_graphics('img/paradojaSimpsons.jpg')
```

Este usuario de esta red social alertaba que, a pesar de que los medios y Gobierno hablaban de una inflaci√≥n del 6,6% hab√≠a productos, como la leche de Mercadona, que hab√≠a subido un 58%. Aqu√≠ hay muchas cosas mal, as√≠ que tendremos que ir por partes para poder analizar debidamente qu√© es lo que est√° pasando.


# üìÉ Los errores de este usuario

1Ô∏è‚É£ Dice que "antes" el precio era de 0,60‚Ç¨ pero no especifica cu√°ndo es ese "antes"
    
* ¬øAyer?
* ¬øLa semana pasada?
* ¬øEl mes pasado?
* ¬øEl a√±o pasado?
* ¬øEl mes de octubre del a√±o pasado?
    
Esta informaci√≥n es importante dado que el dato es, seg√∫n el INE es de un 6,8% a nivel general y del 6,3% la subyacente de noviembre con respecto a noviembre del a√±o pasado. Adem√°s, de utilizar el dato de la subyacente, estar√≠a metiendo algo que el indicador no incluye, pues <strong>la inflaci√≥n subyacente no incluye en su c√°lculo a los alimentos no elaborados</strong>. No aporta el sistema referencial, por lo que ‚ùå

2Ô∏è‚É£ Estamos ante un caso clar√≠simo de Paradoja Simpson. Ahora lo explicamos. 


3Ô∏è‚É£ Son datos no acordes con la realidad.


# ü§Ø  Estamos ante un caso clar√≠simo de Paradoja Simpson

Esta paradoja es muy com√∫n en estad√≠stica pues se trata cuando una tendencia que aparece en varios grupos de datos desaparece cuando estos grupos se combinan y en su lugar, aparece la tendencia contrario para los datos agregados. 

Su nombre se debe al art√≠culo de E. Simpson en 1951 en el que explica que la media de las sumas no es igual a la suma de las medias.

![](https://media.giphy.com/media/l46CyJmS9KUbokzsI/giphy.gif)

Veamos un ejemplo.

> Tenemos en un a√±o 1.000 accidentes de tr√°fico de los cuales 50 no llevaban cintur√≥n y 950 s√≠. De los que <strong>no llevaban cintur√≥n fallecieron 35 personas</strong> mientras que <strong>de los que lo llevaban, fallecieron 110</strong>. La conclusi√≥n parece obvia. <strong> El cintur√≥n de seguridad no es eficaz</strong> ¬°DGT QUIERO MI CARNET!

<details>

<summary>Vamos a verlo con m√°s calma.</summary>

```{r echo=FALSE,warning=FALSE,out.width="110%", trafico}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
paste0("El porcentaje de personas que fallecen sin cinturon es de 100*35/50, es decir: ",100*(35/50),"%") 
paste0("El porcentaje de personas que fallecen con cinturon es de 100*110/950, es decir: ",100*(110/950),"%") 
```
</details>

Parece que queda claro, hay quie ponerse el cintur√≥n. Pues ahora vamos a hacer lo mismo, pero de forma visual.

```{r grafica-s1, echo = FALSE, fig.align = 'center',  include = identical(knitr:::pandoc_to(), 'html'), out.width = '70%'}
knitr::include_graphics('img/GraficoSimpson1.png')
```

Se ve claramente en el anterior gr√°fico que la tendencia es creciente ¬øVerdad? Todo el mundo lo ve y nadie lo puede negar. Pero hagamos una cosa, pintemos los puntitos por grupos, vaya a ser que lo que aqu√≠ pase sea que los puntos de cada grupo est√©n muy juntos. Es decir, desagregemos.

<details>

<summary>¬øQu√© pasar√°? ¬øQu√© misterio habr√°? Despliega haciendo click en la flecha, anda.</summary>

```{r echo=FALSE,warning=FALSE,out.width="110%", misterio}
knitr::include_graphics('img/cParadojaSimpson.png')
```

¬°Vaya! Hay 5 grupos y cada uno decrece. Lo √∫nico que ocurre es que, al agrupar, la tendencia es creciente, pero por grupo se decrece.

Ahora se puede entender mejor por qu√© es tan com√∫n esta paradoja, de hecho, con las vacunas se vio. Hab√≠a gente diciendo que la letalidad entre vacunados era mayor que entre no vacunados. Nuevamente la misma paradoja puesto que cuando desagregabas por edad, las personas menores de 50 a√±os ten√≠an una letalidad del 0% si estaban vacunados y algo mayor entre los mayores de 50 a√±os vacunados. Pero ambas letalidades eran menores que en los no vacunados. Es decir, las vacunas estaban funcionando bien. 
</details>


Pues aqu√≠ pasa lo mismo.

# ‚õîÔ∏è Son datos no acordes con la realidad

En la √∫ltima nota de prensa del INE, se muestra c√≥mo en marzo la inflaci√≥n general era del 9,8% y ahora es del 6,8%. Es incuestinable que se ha reducido.

>‚ö†Ô∏è <strong>`r colorize("NOTA IMPORTANTE","#f3100c")`</strong>

>La reducci√≥n de la inflaci√≥n no significa que los precios bajen, sino que la velocidad a la que crecen se ha ralentizado.

Esta nota es importante puesto que en comparaci√≥n al mes anterior, los precios s√≠ han bajado un 0,1%. Pero no solamente eso, si nos vamos a la nota de prensa de octubre (√∫ltimos datos completos disponibles), podremos ver la evoluci√≥n de los precios por grupo.

```{r echo=FALSE,warning=FALSE,out.width="110%", grupos}
knitr::include_graphics('img/grupos.jpg')
```

# üìù Conclusiones

Hay un error de concepto en esa publicaci√≥n. Si bien se entienden que, dado el contexto en Espa√±a donde los salarios siguen la tendencia a la baja, lo que dificulta la obtenci√≥n de bienes esenciales, la cr√≠tica realizada en esa publicaci√≥n no es correcta. Como se coment√≥ hace tiempo, este proceso inflacionario se deb√≠a al shock en la producci√≥n provocada por la pandemia, el cierre de empresas, los cuellos de botella en los puertos internacionales, la guerra en Ucrania y tambi√©n por la p√©rdida de vidas humanas a causa del covid. Una vez que se fuese resolviendo esta situaci√≥n, la situaci√≥n se normalizar√° y los principales signos de llegar a la normalidad de precios ya se est√°n dando.

El autor de la publicaci√≥n cae, adem√°s del error de concepto y entendimiento de lo que es la inflaci√≥n, en la paradoja Simpson. Al realizar el an√°lisis por subgrupos, se encuentra que en muchos grupos los precios empiezan a bajar, la inflaci√≥n general se ralentiza y, bien es cierto, que a√∫n hay incrementos de precios en el sector de los alimentos, pero no del 58% como se menciona.

Se recuerda que la inflaci√≥n es una subida generalizada de los precios en un periodo en concreto. Ese periodo no est√° detallado en la publicaci√≥n.

No obstante, el objeto de esta P√≠ldora no es el realizar un an√°lisis del proceso inflacionario, sino de dar a conocer esta falacia aqu√≠ comentada para alertar al lector para que en futuras ocasiones, la tenga en cuenta y realice el an√°lisis pertinente.

# Elaboraci√≥n

Este documento ha sido realizado mediante `R` con [{rmarkdown}](https://github.com/rstudio/rmarkdown). Todo lo aqu√≠ comentado se compartir√° todo el **c√≥digo** de esta gu√≠a en mi [GitHub](https://github.com/manuelalen)


## Licencia {-}

[![Licencia: GPLv3](img/license-GPLv3-blue.png)](https://www.gnu.org/licenses/gpl-3.0)

Este documento es publicado bajo **licencia p√∫blica general GNU**,
una licencia libre de copyleft que garantiza a los usuarios finales (personas, organizaciones, compa√±√≠as) la **libertad de usar, estudiar, compartir (copiar) y modificar el software. Por cuestiones personales e idoel√≥gicas, no es necesario citar el contenido de esta gu√≠a.** 



# ‚õ≤Ô∏è Fuentes {-}

* [Nota de Prensa del INE sobre la Inflaci√≥n en noviembre](https://www.ine.es/daco/daco42/daco421/ipcia1122.pdf)
* Simpson, E. H. (1951). The Interpretation of Interaction in Contingency Tables. Journal of the Royal Statistical Society. Series B (Methodological), 13(2), 238‚Äì241. http://www.jstor.org/stable/2984065.

* [Nota de Prensa del INE sobre la inflaci√≥n en octubre](https://www.ine.es/daco/daco42/daco421/ipc1022.pdf)

